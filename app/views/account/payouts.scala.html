@* Noisycamp is a platform for booking music studios.
 * Copyright (C) 2020  Raphael Javaux <raphaeljavaux@gmail.com>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *@

@import java.time.LocalDate

@import play.api.Configuration
@import squants.market.Money

@import models.Payout

@(
    identity: models.Identity,
    currentBalance: Money,
    nextPayout: LocalDate,
    stripeOAuthUrl: String,
    payouts: Seq[Payout])(
    implicit req: RequestHeader, config: Configuration)

@connectStripeAccount = {
    <div class="grid-x grid-padding-y grid-padding-x">
        <div class="cell small-12">
            <div class="grid-x grid-margin-y grid-margin-x callout warning">
                <div class="cell shrink text-center">
                    <i class="fi-lock" style="font-size: 4rem"></i>
                </div>

                <div class="cell auto">
                    NoisyCamp uses Stripe to get you paid quickly and keep your personal and
                    payment information secure. Thousands of companies around the world trust
                    Stripe to process payments for their users. Set up a Stripe account to get
                    paid with NoisyCamp.
                </div>
            </div>
        </div>

        <div class="cell small-12 text-center">
            <a href="@stripeOAuthUrl" class="button large primary">
                Setup payouts on Stripe
            </a>
        </div>
    </div>
}

@layout(
    Seq("Payout preferences", identity.user.fullName.getOrElse(identity.user.email)),
    identity=identity) {

    <div class="grid-x grid-margin-y grid-padding-x">
        @identity.user.stripeUserId match  {
            case None => {
                <div class="cell small-12">
                    <div class="panel-section">
                        @connectStripeAccount
                    </div>
                </div>
            }
            case Some(stripeUserId) => {
                <div class="cell medium-4">
                    <div class="panel-section">
                        <h4>Current balance</h4>

                        @tags.moneyAmount(currentBalance)
                    </div>
                </div>

                <div class="cell medium-4">
                    <div class="panel-section">
                        <h4>Next payout</h4>

                        @tags.localDate(nextPayout)
                    </div>
                </div>

                <div class="cell medium-4">
                    <div class="panel-section">
                        <h4>Payout settings</h4>

                        <a
                            href="@controllers.account.routes.PayoutsController.stripeDashboard"
                            target="_blank">
                            &#x29C9;
                            Open Stripe dashboard
                        </a>
                    </div>
                </div>

                <div class="cell medium-12">
                    <div class="panel-section">
                        <div class="grid-x grid-padding-y">
                            <h4 class="cell small-12">Payout history</h4>

                            @if(payouts.isEmpty) {
                                <p class="cell small-12 text-center">
                                    Payouts to your bank account will appear here.
                                </p>
                            } else {
                                <table class="cell small-12">
                                    <thead>
                                        <tr>
                                            <th width="700">Date</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @for(payout <- payouts) {
                                            <tr>
                                                <td>
                                                    @tags.localDate(payout.date)
                                                </td>
                                                <td>@tags.moneyAmount(payout.amount)</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                        </div>
                    </div>
                </div>
            }
        }
    </div>
}
