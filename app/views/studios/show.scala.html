@* Noisycamp is a platform for booking music studios.
 * Copyright (C) 2019  Raphael Javaux <raphaeljavaux@gmail.com>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *@

@import java.time.Instant

@import play.api.Configuration
@import play.api.libs.json.Json
@import play.api.mvc.RequestHeader

@import _root_.controllers.ClientConfig
@import models.Picture
@import misc.JsonWrites._

@(
    clientConfig: ClientConfig,
    user: Option[models.User],
    studio: models.Studio,
    pricingPolicy: LocalPricingPolicy,
    pictures: Seq[models.Picture#Id])(
    implicit req: RequestHeader, config: Configuration)

@head = {
    <link
        rel="stylesheet"
        href="@routes.Assets.versioned("stylesheets/studios/show.css")">

    <link
        rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css">
}

@bookingPanel = {
    <div class="grid-x grid-padding-x">
        <div class="cell small-12 text-center">
            <h2>
                @tags.moneyAmount(pricingPolicy.pricePerHour)
                <small>per hour</small>
            </h2>
        </div>

        @for(eveningPolicy <- pricingPolicy.evening) {
            <div class="cell small-6 text-left specific-pricing">
                After @eveningPolicy.beginsAt
            </div>
            <div class="cell small-6 text-right specific-pricing">
                @tags.moneyAmount(eveningPolicy.pricePerHour)
                <small>per hour</small>
            </div>
        }

        @for(weekendPolicy <- pricingPolicy.weekend) {
            <div class="cell small-6 text-left specific-pricing">
                Weekend
            </div>
            <div class="cell small-6 text-right specific-pricing">
                @tags.moneyAmount(weekendPolicy.pricePerHour)
                <small>per hour</small>
            </div>
        }

        <div class="cell small-12"><hr></div>

        <div class="cell small-12">
            <booking-form
                current-time="@Instant.now.toString"
                :studio-id='@studio.id'
                :opening-schedule='@tags.asJson(Json.toJson(studio.openingSchedule))'
                :occupancies="[]"
                :min-booking-duration="@studio.bookingPolicy.minBookingDuration.getSeconds()"
                :pricing-policy='@tags.asJson(Json.toJson(pricingPolicy))'>
            </booking-form>
        </div>

        <div class="cell small-12 text-center">
            <a
                href="#availability"
                onclick="$('html, body').animate({
                    scrollTop: $('#availability').offset().top
                }, 500); return false">
                Show availabilities
            </a>
        </div>
    </div>
}

@layout(
    Seq(studio.name, "Music studio to rent in " + studio.location.address.city),
    head=head, clientConfig=clientConfig, user=user) {

    <div class="grid-container">
        <div class="grid-x grid-padding-x grid-padding-y">
            <div class="cell small-12">
                <div class="grid-x">
                    <div class="cell">
                        <h1>@studio.name</h1>
                    </div>

                    <div class="cell studio-city">
                        <h5>
                            <small>
                                <i class="fi-marker"></i>&nbsp;
                                @studio.location.address.city,
                                @studio.location.address.country.name
                            </small>
                        </h5>
                    </div>
                </div>
            </div>

            <div class="cell small-12 medium-8">
                <div class="panel-section">
                    <picture-carousel
                        alt="@{studio.name} picture"
                        :picture-ids='@tags.asJson(Json.toJson(pictures))'
                        :width="800"
                        :height="450">
                    </picture-carousel>

                    <hr>

                    <h3>Description</h3>

                    <p>@tags.nl2br(studio.description.trim)</p>

                    <hr>

                    <h3>Opening schedule</h3>

                    @tags.openingSchedule(studio.openingSchedule)

                    <hr>

                    <h3 id="availability">Availability</h3>

                    <calendar
                        current-time="@Instant.now.toString"
                        :opening-schedule='@tags.asJson(Json.toJson(studio.openingSchedule))'
                        :events="[]">
                    </calendar>

                    <hr>

                    <h3>Location</h3>

                    <p class="address">
                        @tags.address(studio.location.address)
                    </p>

                    <location-map
                        :lat="@studio.location.lat"
                        :long="@studio.location.long"
                        :zoom="13">
                    </location-map>

                    <hr>
                </div>
            </div>

            <div class="cell small-12 medium-4">
                <div class="panel-section booking-panel">
                    @bookingPanel
                </div>
            </div>
        </div>
    </div>
}
